<?php // *** INICIO DE SESIÓN *** // Se utiliza para mantener información persistente sobre el usuario durante su navegación session_start(); // Inicia o reanuda una sesión // *** CONFIGURACIÓN DE LA BASE DE DATOS *** // Configuración básica para conectar a una base de datos MySQL $servidor = "localhost"; // Dirección del servidor de base de datos $usuario = "root"; // Usuario de la base de datos $contrasena = ""; // Contraseña del usuario $base_datos = "mi_base_datos"; // Nombre de la base de datos // *** CONEXIÓN A LA BASE DE DATOS *** $conn = new mysqli($servidor, $usuario, $contrasena, $base_datos); // Verifica si la conexión ha sido exitosa if ($conn->connect_error) { die("Error de conexión: " . $conn->connect_error); // Termina el script si no hay conexión } // *** FUNCIONES *** // Se utilizan para dividir el código en piezas reutilizables function registrarUsuario($conn, $nombre, $email, $contrasena) { // Preparamos una consulta segura para evitar inyecciones SQL $stmt = $conn->prepare("INSERT INTO usuarios (nombre, email, contrasena) VALUES (?, ?, ?)"); $stmt->bind_param("sss", $nombre, $email, $hashedPassword); // Vinculamos los parámetros // Hash de la contraseña para proteger los datos del usuario $hashedPassword = password_hash($contrasena, PASSWORD_BCRYPT); $stmt->execute(); // Ejecutamos la consulta $stmt->close(); // Cerramos el statement } // *** MANEJO DE FORMULARIOS *** if ($_SERVER["REQUEST_METHOD"] === "POST") { if (isset($_POST["registro"])) { // Obtenemos datos del formulario $nombre = $_POST["nombre"]; $email = $_POST["email"]; $contrasena = $_POST["contrasena"]; // Llamamos a la función para registrar al usuario registrarUsuario($conn, $nombre, $email, $contrasena); echo "Usuario registrado con éxito."; } elseif (isset($_POST["login"])) { // Iniciar sesión $email = $_POST["email"]; $contrasena = $_POST["contrasena"]; // Comprobar credenciales $stmt = $conn->prepare("SELECT id, contrasena FROM usuarios WHERE email = ?"); $stmt->bind_param("s", $email); $stmt->execute(); $resultado = $stmt->get_result(); if ($resultado->num_rows > 0) { $usuario = $resultado->fetch_assoc(); if (password_verify($contrasena, $usuario["contrasena"])) { $_SESSION["usuario_id"] = $usuario["id"]; // Guardamos el ID del usuario en la sesión echo "Inicio de sesión exitoso."; } else { echo "Contraseña incorrecta."; } } else { echo "Usuario no encontrado."; } $stmt->close(); } } // *** CIERRE DE SESIÓN *** if (isset($_GET["logout"])) { session_destroy(); // Eliminamos todas las variables de sesión header("Location: estudio.php"); // Redirigimos a la misma página exit(); } ?> <!DOCTYPE html> <html lang="es"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Estudio PHP</title> </head> <body> <!-- *** FORMULARIO DE REGISTRO *** --> <h2>Registro</h2> <form method="POST" action=""> <label for="nombre">Nombre:</label> <input type="text" id="nombre" name="nombre" required> <br> <label for="email">Email:</label> <input type="email" id="email" name="email" required> <br> <label for="contrasena">Contraseña:</label> <input type="password" id="contrasena" name="contrasena" required> <br> <button type="submit" name="registro">Registrar</button> </form> <!-- *** FORMULARIO DE INICIO DE SESIÓN *** --> <h2>Iniciar Sesión</h2> <form method="POST" action=""> <label for="email">Email:</label> <input type="email" id="email" name="email" required> <br> <label for="contrasena">Contraseña:</label> <input type="password" id="contrasena" name="contrasena" required> <br> <button type="submit" name="login">Iniciar Sesión</button> </form> <!-- *** CERRAR SESIÓN *** --> <?php if (isset($_SESSION["usuario_id"])): ?> <p>Usuario conectado. <a href="?logout=1">Cerrar sesión</a></p> <?php endif; ?> </body> </html>
    <?php // *** INICIO DE SESIÓN *** // Se utiliza para mantener información persistente sobre el usuario durante su navegación session_start(); // Inicia o reanuda una sesión // *** CONFIGURACIÓN DE LA BASE DE DATOS *** // Configuración básica para conectar a una base de datos MySQL $servidor = "localhost"; // Dirección del servidor de base de datos $usuario = "root"; // Usuario de la base de datos $contrasena = ""; // Contraseña del usuario $base_datos = "mi_base_datos"; // Nombre de la base de datos // *** CONEXIÓN A LA BASE DE DATOS *** $conn = new mysqli($servidor, $usuario, $contrasena, $base_datos); // Verifica si la conexión ha sido exitosa if ($conn->connect_error) { die("Error de conexión: " . $conn->connect_error); // Termina el script si no hay conexión } // *** FUNCIONES *** // Se utilizan para dividir el código en piezas reutilizables function registrarUsuario($conn, $nombre, $email, $contrasena) { // Preparamos una consulta segura para evitar inyecciones SQL $stmt = $conn->prepare("INSERT INTO usuarios (nombre, email, contrasena) VALUES (?, ?, ?)"); $stmt->bind_param("sss", $nombre, $email, $hashedPassword); // Vinculamos los parámetros // Hash de la contraseña para proteger los datos del usuario $hashedPassword = password_hash($contrasena, PASSWORD_BCRYPT); $stmt->execute(); // Ejecutamos la consulta $stmt->close(); // Cerramos el statement } // *** MANEJO DE FORMULARIOS *** if ($_SERVER["REQUEST_METHOD"] === "POST") { if (isset($_POST["registro"])) { // Obtenemos datos del formulario $nombre = $_POST["nombre"]; $email = $_POST["email"]; $contrasena = $_POST["contrasena"]; // Llamamos a la función para registrar al usuario registrarUsuario($conn, $nombre, $email, $contrasena); echo "Usuario registrado con éxito."; } elseif (isset($_POST["login"])) { // Iniciar sesión $email = $_POST["email"]; $contrasena = $_POST["contrasena"]; // Comprobar credenciales $stmt = $conn->prepare("SELECT id, contrasena FROM usuarios WHERE email = ?"); $stmt->bind_param("s", $email); $stmt->execute(); $resultado = $stmt->get_result(); if ($resultado->num_rows > 0) { $usuario = $resultado->fetch_assoc(); if (password_verify($contrasena, $usuario["contrasena"])) { $_SESSION["usuario_id"] = $usuario["id"]; // Guardamos el ID del usuario en la sesión echo "Inicio de sesión exitoso."; } else { echo "Contraseña incorrecta."; } } else { echo "Usuario no encontrado."; } $stmt->close(); } } // *** CIERRE DE SESIÓN *** if (isset($_GET["logout"])) { session_destroy(); // Eliminamos todas las variables de sesión header("Location: estudio.php"); // Redirigimos a la misma página exit(); } ?>
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Estudio PHP</title>
</head>
<body>
	<!-- *** FORMULARIO DE REGISTRO *** -->
	<h2>Registro</h2>
	<form method="POST" action=""> <label for="nombre">Nombre:</label> <input type="text" id="nombre" name="nombre" required> <br> <label for="email">Email:</label> <input type="email" id="email" name="email" required> <br> <label for="contrasena">Contraseña:</label> <input type="password" id="contrasena" name="contrasena" required> <br> <button type="submit" name="registro">Registrar</button> </form>
	<!-- *** FORMULARIO DE INICIO DE SESIÓN *** -->
	<h2>Iniciar Sesión</h2>
	<form method="POST" action=""> <label for="email">Email:</label> <input type="email" id="email" name="email" required> <br> <label for="contrasena">Contraseña:</label> <input type="password" id="contrasena" name="contrasena" required> <br> <button type="submit" name="login">Iniciar Sesión</button> </form>
	<!-- *** CERRAR SESIÓN *** -->
	<?php if (isset($_SESSION["usuario_id"])): ?>
	<p>Usuario conectado. <a href="?logout=1">Cerrar sesión</a></p>
	<?php endif; ?> </body>
</html>